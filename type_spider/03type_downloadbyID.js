////第3步,通过已知道的type_id.json来下载html，获取--详情页

var casper = require('casper').create();



var origin="dianping.com/shop/";

var _ID=["19346692","15928792","32415972","32851973","23186404","24710973","4675576","65783606","66056748","66147773","65874627","66798847","17649234","56585294","66907888","48217808","57660375","65935989","22786471","66859388","67727048","6197945","8075967","22831717","59161244","4675576","65874627","65783606","66056748","66907888","68040020","56585294","67306915","21355814","33577621","66115906","23612458","58002601","58428866","58477090","24814071","66914063","66375512","67264811","57542609","66623783","67942083","57401384","32460671","67511798","67727048","22831717","18574720","23298195","5378487","5215499","2573281","6131597","5481036","1967515","65802519","59140073","48218958","2636197","66868228","1903450","13847546","66482547","3276715","23511271","57946711","19208003","22178254","58195517","24940681","66575213","18681021","18206018","66147773","17619977","59226504","66090751","38224593","27191548","32551509","58252774","32551531","57542719","24513894","59200450","65935989","66175791","57542609","66056748","66089334","32560493","24814071","43387813","57542664","65874627","48008034","57401384","8970544","23186404","66622174","65562287","22786471","58477090","67321525","66482547","33577621","57660375","23744065","22314602","67234997","68040020","17649234","55783716","48215810","32460671","26230821","27532406","18968550","59018968","23612458","57946711","58345020","43597044","66867200","43608277","33708724","21680294","27334915","32336771","58385132","32868548","66406820","32867434","34354294","22921280","22687341","23599469","65482635","27202645","65832083","66862983","65692565","24957075","65692417","56637585","21284369","45259525","65783606","17876733","4190606","32489073","67091645","24078468","66210738","66285562","48230193","48218958","27011464","57385938","59151240","27520171","22490174","59140073","57773342","11547147","21569978","57901923","22247023","17639709","66798847","23422312","57967056","22890618","65966231","65704804","22764281","23679757","59132186","32319115","59148095","58539451","67511798","66907888","43623718","65594222","65316674","67925583","67306915","32585428","66108560","58963481","24805843","65734821","22517744","65189003","66806909","28634845","2843770","24313334","59182241","67052672","58395788","59096178","27498459","23515790","66294121","23101166","8976064","65969317","65610006","43597621","57440094","65610403","67104001","23090484","18496676","65486810","22823160","27347480","63170252","4518060","57901923","2356651","28634845","57381616","67097829","62814955","67055082","66158336","67104001","13799609","27469324","18496676","58232234","27511239","33708724","22823160","57440094","57838570","43597621","21680294","65486810","23077960","65420463","65593756"];

//index 1_1
var _TYPE="keepfit";
var links=[];

var count=_ID.length; //爬地图&主页

//var count=198;//爬评论

var downNum=0;

var down_ID=[];
//爬地图&主页
for (var i = _ID.length-1; i >= 0; i--) {
	//links.push("http://m."+origin+_ID[i]+"/map");//下地图;
    //links.push("http://m."+origin+_ID[i]);//主页
    links.push("http://www."+origin+_ID[i]+'/review_more?pageno=1');//爬评论,第1页
	count--;
	if (count<=0) {
		
		console.log("url准备好"+links.length+"个");
		next();
	};
};

//爬评论
/*
for (var i = 198; i >= 1; i--) {
    links.push(origin+i);

    count--;
    if (count<=0) {
        
        console.log("url准备好"+links.length+"个");
        next();
    };
};
*/
function next(){
	casper.start().each(links, function(self, link) {
    	self.thenOpen(link, function() {

    			//var page=this.getCurrentUrl().replace(origin,'').replace("/map",'')+'m.html';//地图
                
               // var page=this.getCurrentUrl().replace(origin,'')+'.html';//主页
                
                var page=this.getCurrentUrl().replace(origin,'').replace("http://www.","").replace("/review_more?pageno",'')+'p.html';//评论

    			downNum++;
    			down_ID.push(page.replace(".html",""));

    			console.log(page+"-----------第"+downNum);
				this.download(link, "./"+_TYPE+"_page/"+page); 
       
   	 	});
	});

	casper.run(function() {
		var vsResult=chaji_array(down_ID,_ID);
	    this.echo('download Done.but'+vsResult).exit();

	});
};

function chaji_array(arr1,arr2){
    var arr3 = [];
    for (var i = 0; i < arr1.length; i++) {
                        var flag = true;
                        for (var j = 0; j < arr2.length; j++) {
                            if (arr2[j] == arr1[i]) {
                                flag = false;
                            }
                        }
                        if (flag) {
                            arr3.push(arr1[i]);
                        }
                    }
return arr3;
}