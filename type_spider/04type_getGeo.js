////第4步 lat,lng,保存为type_geo.json,原文件缺失的清单type_erro_id.json
// 

// 
const fs=require('fs');//读写文件
var cheerio=require('cheerio');//解析html
var items=[];

var count=850;//先了解共有几组数据 count:0表示一个数据
var _id=["65657946","13797714","37924822","66958462","1900237","4040752","20852737","4224981","3099376","2430175","1860781","14069230","19404774","21117907","15125459","58520998","5310305","4285283","59158288","19177145","6598444","5405575","6264797","18235182","3279352","5398754","21225189","13816390","17668836","8020597","18221130","19688856","8082893","18147203","18243052","9963894","6270168","21872348","14077549","14810677","24739378","18243078","17574828","17629944","18243089","20637524","13907281","9510573","21087711","6236096","8887859","4272243","21351653","22580275","5440324","2917057","5165962","8867308","38124876","4736592","5366135","19688773","5969323","6093984","21140038","52353108","24839799","2566420","3474166","32344804","18942182","21088333","68150001","17955430","19799481","6598003","3005029","9322325","2341474","14728898","1945063","2317210","24980688","5440293","2132620","5596577","24861543","1865335","18361962","15916171","18279438","2689339","1859041","2130763","2625919","2122489","24000705","66987223","21088774","18561437","56535573","24982091","21056109","57565304","5636591","68952059","1906807","4733868","8065614","5192476","18086382","566238","1862023","48160403","13933538","66891865","14685731","8723510","58204597","4088920","4730958","5641379","15016890","5564758","50687521","66532081","14722100","17877145","21574947","32856977","56541479","15966949","4088893","5707864","17200804","6082611","21629798","21643015","3226891","15078590","4088839","14201834","13784219","5411252","4088845","55017153","1998658","5990107","67688568","23894168","22917039","3658378","4221069","4101265","2076613","15083341","6038190","4127412","8937697","17969607","1865374","1861573","21398139","66666150","65501357","1863145","13908634","56995833","27182859","17223606","2353468","19476947","2447335","6049844","24339377","17206301","2917363","20646570","9071607","22927704","8955997","6016722","67237612","66210896","45345977","27349482","2285296","19012953","3151807","4213779","20953125","32578459","17706220","27143678","19343290","5358850","17931157","3129310","50543988","8694625","16968157","52351789","43548493","5707778","5576769","3187096","24258557","58335256","17647167","18016429","4668972","48215802","14897144","2455816","22051483","5273808","32735687","22510756","19346450","22212913","13704527","2933362","5286092","13668518","66622800","5723772","2002303","1861714","66080243","21066806","18678351","2315659","68142752","33588865","19643180","4275251","18338775","17865678","1890127","11560259","21088790","6139806","17207864","2776921","5501828","3291097","22676730","8901732","14902419","6302943","8043244","1865299","5398409","10008831","1865230","13821057","1864249","22178979","23910574","1962364","15115505","18275476","9619508","22159302","2507239","22423093","3522172","18586324","23648291","1906939","13859602","3287692","2983420","6169773","24610200","5636204","5490042","3274498","5319824","7074634","66946366","52344763","22445315","12286104","67847568","22231352","4757221","18275442","27111501","17781981","3898612","20916835","45251760","21097456","17651251","27542339","13788656","21089316","58315853","21953916","8697361","22176533","5481532","3531184","5338136","22370921","65148532","5613471","4224509","1964062","32303203","2197744","5680087","8849493","4527111","8886143","9952095","22649055","4080985","56534348","58204408","8414966","5320784","2374135","4130555","67354785","52345803","4126867","32571316","1863577","27531620","1865872","6082807","4052152","67211329","1859284","3099445","3992830","3207838","3386770","2967523","2485744","2655127","8075413","3891655","1859713","4729548","58142922","13743895","38222087","32498993","2111848","2837899","21263611","56566669","21563419","67263385","25039159","20245703","3211078","67450486","52350949","3207313","13855789","2576497","2968396","32480912","23306541","15132326","19338046","566481","3707533","2918491","5563080","67340947","12592892","6088774","6206402","2420029","38224505","65562595","4514994","1964068","1865131","17880792","3274483","21173797","1863382","5740593","4088818","4209866","1860757","5501140","2318227","3161866","57188172","2034124","3002854","19202890","1900957","8284930","21103887","1862086","13715067","24935802","22651371","58012341","18051493","4534278","2026369","2656813","3167107","2808853","21010187","5352934","27188730","32302968","5256043","37800626","5460183","5514636","18210723","23911666","5493906","8684404","45833171","20915073","3173002","22358477","5308414","27349276","27123840","5564767","57046167","56638050","9802742","13790041","2735095","58211270","27349561","13914396","20827877","4662132","4711435","19584888","66529200","1865041","21725638","1860883","24365979","4564085","3010942","1859980","1864801","4728270","2801347","2656780","58012455","5923797","2656765","8825402","2065465","4518708","18076360","19483330","59250518","15929855","19278344","15907661","65413900","48162097","3569686","23211294","4538976","5272926","2047408","67839374","1883740","17173183","1864450","17775229","32337122","67261205","8852180","28633566","4688855","23116947","2967529","8894456","3202789","23216759","17229995","39501281","4727386","18275501","32333967","2294050","3280105","17202164","23545178","19586380","23344217","5480345","18276081","3368047","3874813","5248298","22725368","18353563","21561578","67549383","57214780","23678177","58448197","24304811","23670797","27550679","2132602","57626489","3167764","58353607","4651567","10338677","1964065","65488567","3294679","3671506","5193261","65560214","19410646","14724030","1862041","18987905","2949700","61103776","20642579","66542428","2642347","20700551","6360850","6338987","1861282","13727810","15964826","8900612","43612326","3224227","4500508","5363770","4651806","5277372","23225442","21602905","17641039","19581610","4500489","69062516","3888823","5328286","4081834","18583660","57456719","19119849","2656735","22807423","68050449","22377941","5475883","23423168","24760938","17855255","65753952","14879112","9789260","23336132","5112893","58556837","2216896","2938450","3438274","24924657","32560397","3642598","54262199","6072583","4956708","23490901","24531170","66352975","13793507","38052062","43625893","13921447","6438622","3446812","19473566","51934327","27292279","8922069","58076882","4536811","16335088","4656502","38156897","57559252","58058135","20939862","4131089","24679134","37802226","19468505","24048612","2382028","5623337","66345823","4089040","2039983","57394096","21653874","23082003","66239112","13708498","4557536","5232837","4533407","17202210","22216180","8723322","13916656","9032855","18076661","1863133","27273961","57213667","66299816","19291192","67065405","4115462","13785958","13714926","4088836","1964059","18542032","13828398","13704522","18569988","4064977","17202263","48217746","38063707","5228264","3447598","8881336","5427555","13829255","5101531","15863508","5372308","3291547","18202424","14161996","5430934","24714481","2283451","66995240","37771107","6422392","32302920","51638172","43607412","66956588","6215873","67312341","67354395","24093731","14746249","4276337","21921944","4671433","22384915","37769382","22212984","66448329","4119740","52239183","17615307","23083859","66874970","3558298","5483254","63975816","2797534","6449488","26962476","66864012","2289259","2915875","4074148","4548546","57544150","5984579","5454478","5490328","2666827","5244936","3098965","24760929","20778619","38062157","67297787","41645817","17766555","65765359","15118103","22055561","9070776","19657658","9967592","14750391","4683098","50773826","8536595","5664419","4534316","5526522","24306494","57194883","4516273","5490335","3347965","4089385","38206520","6010240","24034105","23982221","65713694","37769323","43625480","32658731","18244828","8989183","32566169","23629952","21106222","2913364","65662739","56803002","67038421","57419880","8042009"];

var pageNums=1;
var path=[];
var erro_id=[];

var _TYPE="shopping";

for (var i = _id.length - 1; i >= 0; i--) {

	 path.push("./"+_TYPE+"_page/"+_id[i]+"m.html");
	
	
	
};

/*
for (var i = path.length - 1; i >= 0; i--) {
		fs.unlinkSync(path[i], (err) => {
	  if (err) throw err;
	  console.log('successfully deleted ');
	});
};

*/


for (var i = path.length - 1; i >= 0; i--) {
	 
	


	try {
    	var htmlfile=fs.readFileSync(path[i]);
		var url_id=path[i].replace('./'+_TYPE+'_page/','').replace('m.html','');
		var $ = cheerio.load(htmlfile);
		var name=$('title').text();
		var arraygeo=$("script").last().text().replace("facade(","").replace(")","");

		var ipos;
		
		ipos = arraygeo.indexOf(";");
		var str1=arraygeo.substring(0,ipos).replace('latitude:"",',"").replace('longitude:"",',"").replace("}}","").replace('popUrl:"//www.dpfile.com/mod/app-m-sosomap/0.3.1/css/img/pop.png"',""); //取前部分
		var str2=arraygeo.substring(ipos,arraygeo.length);//取后部分

		var obj= str1.replace('type:"qqmap",','').replace('overseascity:false,','').replace('pinUrl:"//www.dpfile.com/mod/app-m-sosomap/0.3.1/css/img/pin.png",','}');

		//console.log(i);
		items.push(obj.replace('{entry:"app-m-sosomap", data: {',"{id:"+url_id+","));
		    
		  // console.log("00"+items.length); 

	} catch (err) {
		console.log(path[i]+"-------------------------------------------------");
		erro_id.push(path[i].replace('./'+_TYPE+'_page/','').replace('m.html',''));
	    console.error(err);
	}

	 
	fs.writeFile("./public/data/"+_TYPE+"_geo"+pageNums+".json",JSON.stringify(items),function(err){
					    if(!err)
					    console.log("done!!!!!!"+items.length)
					});
	fs.writeFile("./public/data/"+_TYPE+"_erro_id.json",JSON.stringify(erro_id),function(err){
					    if(!err)
					    console.log("erro!!!!!!"+erro_id.length)
					});

};



