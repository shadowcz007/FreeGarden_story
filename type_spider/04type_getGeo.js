////第4步 lat,lng,保存为type_geo.json,原文件缺失的清单type_erro_id.json
// 

// 
const fs=require('fs');//读写文件
var cheerio=require('cheerio');//解析html
var items=[];

var count=850;//先了解共有几组数据 count:0表示一个数据
var _id=["68546921","21875755","69280983","21878111","45551258","67087734","23131165","24723684","45248607","58476349","57130006","65612745","58790732","27520828","50650194","41513243","59574551","68594815","66932959","19641085","19641079","3287650","21881706","67453686","69131145","21213105","68253941","63900010","57231942","32771821","44064028","68125590","45683227","44135309","56716652","67891793","23115634","65938920","43840291","66855906","66856028","66855982","59015066","20794000","67314050","66247001","59401931","67330730","69195071","48386799","68199123","67434112","57449895","27470829","44306566","67145487","48331555","15004242","44285240","41313368","50649287","20793941","15008251","39911859","63228630","45432078","21790789","66401563","56765343","66851228","66701343","66865130","21742363","39885249","43762787","40821351","69053297","44207494","66299252","66851222","14884231","58734337","66053889","43849963","45555972","66833567","66851214","45546922","57618353","27483197","63789301","65692038","66859319","43790449","48013175","56672018","21015311","19343286","48915928","58764657","66073922","66988198","57871265","39819772","57234708","48142750","20015138","57486360","65996906","57234686","66545558","65110059","65848789","50572122","23939116","57101070","67554456","68185608","57453697","65703763","57503646","43858386","68007172","19805278","68374670","39736959","5475869","15606319","41518721","50526787","44317773","66259016","68518606","50465556","40794315","58690265","16196527","65155683","59254721","67513508","66130495","58500759","13688650","14182719","22253903","50475151","43625937","16461140","15608625","67399392","66070513","21044246","45316150","6171719","9953877","56631716","5501039","1794814","13728999","21292203","5597200","3583897","22048658","8645242","57698436","5232859","3294358","8063409","8023999","5696808","18248383","63329185","18124630","501117","5535014","48008822","23594612","5733976","5580320","65613217","12276029","504230","3561583","48144069","2372317","23480079","27247340","2458441","5480351","4707828","19407406","2118721","10344248","3488704","56792194","15977078","34531688","34610300","58068308","3637168","6362545","39082233","18871682","28364395","2251243","32303159","23546896","3237511","50672222","9953569","2542840","57674724","21591797","24901530","23230694","57966615","57965720","2785468","57944157","37115855","15972340","57911783","19083297","5705958","8778538","11865072","17862666","15978712","6152649","20705608","53493040","7884668","22917485","14895992","54037516","19504718","2559355","6454792","5274736","504633","23842242","2670406","3640447","24026089","5277310","10647823","19475129","504983","18039854","23990997","4119885","4117270","69101450","14069848","6044000","8039800","4078861","11575638","15948041","13731430","58686349","32845730","21225390","14904820","23136915","8970271","6339615","1918489","22664795","9334265","65486698","9962619","43611103","21783991","8979048","11565056","10017328","5375434","23677027","3928009","501760","13761139","17544183","19669388","2391781","11576659","2365864","8899735","504803","11552264","3705889","2630668","24930694","44390655","5238667","17958978","67511043","18585943","21761422","504257","66992208","21274580","65720770","17820531","13784786","4088803","500725","23115461","11557105","5296907","19111066","24006760","2198275","20649303","21401519","20836444","10351567","21617570","505834","3328660","13777467","5725562","18773333","8932900","22219200","1903537","19122448","4621834","5735627","13828402","3163573","4517519","4501766","2662798","66705660","66957586","65668787","2353789","22918556","21010299","17775071","14152282","6861440","68073496","67737592","4182478","58040890","58026602","65610555","24506732","66944480","2186266","27309186","23361031","66963900","67091786","582525","5581360","66941012","66085559","5589814","32775299","13793504","58579931","23939291","5335019","5682032","559797","569170","5205627","32631318","4287886","24011708","37941280","5677427","22948918","45313254","28425895","19493716","48007686","32482421","2091979","19160471","23983981","65429649","14708435","586793","9315113","24047344","12286664","12594274","6253775","1936798","10349556","6378140","3181222","2060182","21721525","16790960","6009237","3274321","21558402","8910946","21154535","15855297","4525754","22567564","6444915","56668608","8048444","18477995","18078964","3110236","9034704","5393563","5594918","21362798","21875692","21988849","17202263","8876744","6603779","3536677","4298506","506822","16990316","1923271","20693657","502015","8853284","11557303","8063324","5438169","6087982","9972797","2236912","8842719","19603575","11554408","9000063","13768330","5482078","8959174","18499250","17179979","15864424","4546486","6311722","2869684","18635372","18260088","17175837","501108","61060258","13932592","22389151","10022263","65948441"];

var pageNums=3;
var path=[];
var erro_id=[];

var _TYPE="eat_Mr_Nice";

for (var i = _id.length - 1; i >= 0; i--) {

	 path.push("./"+_TYPE+"_page/"+_id[i]+"m.html");
	
	console.log(path);
	
};

/*
for (var i = path.length - 1; i >= 0; i--) {
		fs.unlinkSync(path[i], (err) => {
	  if (err) throw err;
	  console.log('successfully deleted ');
	});
};

*/


for (var i = path.length - 1; i >= 0; i--) {
	 
	


	try {
    	var htmlfile=fs.readFileSync(path[i]);
		var url_id=path[i].replace('./'+_TYPE+'_page/','').replace('m.html','');
		var $ = cheerio.load(htmlfile);
		var name=$('title').text();
		var arraygeo=$("script").last().text().replace("facade(","").replace(")","");

		var ipos;
		
		ipos = arraygeo.indexOf(";");
		var str1=arraygeo.substring(0,ipos).replace('latitude:"",',"").replace('longitude:"",',"").replace("}}","").replace('popUrl:"//www.dpfile.com/mod/app-m-sosomap/0.3.1/css/img/pop.png"',""); //取前部分
		var str2=arraygeo.substring(ipos,arraygeo.length);//取后部分

		var obj= str1.replace('type:"qqmap",','').replace('overseascity:false,','').replace('pinUrl:"//www.dpfile.com/mod/app-m-sosomap/0.3.1/css/img/pin.png",','}');

		//console.log(i);
		items.push(obj.replace('{entry:"app-m-sosomap", data: {',"{id:"+url_id+","));
		    
		  // console.log("00"+items.length); 

	} catch (err) {
		console.log(path[i]+"-------------------------------------------------");
		erro_id.push(path[i].replace('./'+_TYPE+'_page/','').replace('m.html',''));
	    console.error(err);
	}

	 
	fs.writeFile("./public/data/"+_TYPE+"_geo"+pageNums+".json",JSON.stringify(items,null,2),function(err){
					    if(!err)
					    console.log("done!!!!!!"+items.length)
					});
	fs.writeFile("./public/data/"+_TYPE+"_erro_id.json",JSON.stringify(erro_id),function(err){
					    if(!err)
					    console.log("erro!!!!!!"+erro_id.length)
					});

};



